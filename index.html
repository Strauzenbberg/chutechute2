<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üéØ Chute Chute ‚Äî Ranking Global</title>
  
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéØ</text></svg>">

  <style>
    .light { --bg: #ffffff; --fg: #222; --primary: #0B3B60; --button-bg: var(--primary); --button-color: #fff; --muted: #555; --card: #f7f7f7; --border: #e6eef5; }
    .dark { --bg: #0b1220; --fg: #e6eef9; --primary: #D4AF37; --button-bg: var(--primary); --button-color: #000; --muted: #9aa8bf; --card: #071022; --border: #122033; }
    body { margin: 0; font-family: Inter, sans-serif; background: var(--bg); color: var(--fg); transition: 0.3s; }
    main { min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 2rem; max-width: 700px; margin: 0 auto; }
    .topbar { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .card { width: 100%; background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
    .row { display: flex; align-items: center; gap: .5rem; flex-wrap: wrap; margin-bottom: 1rem; }
    input, select, button { font-size: 1rem; padding: .6rem; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: var(--fg); }
    button { background: var(--button-bg); color: var(--button-color); border: none; cursor: pointer; font-weight: bold; }
    .mensagem { margin-top: 1rem; font-size: 1.1rem; min-height: 1.4em; text-align: center; font-weight: bold; }
    .muted { color: var(--muted); font-size: 0.9rem; }
    .hidden { display: none !important; }
    .ranking-section { margin-top: 2rem; width: 100%; border-top: 2px solid var(--border); padding-top: 1rem; }
    .ranking-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    .ranking-table th, .ranking-table td { text-align: left; padding: 10px; border-bottom: 1px solid var(--border); }
    .status-online { color: #2ecc71; font-size: 0.75rem; display: flex; align-items: center; gap: 5px; }
    .dot { width: 7px; height: 7px; background: #2ecc71; border-radius: 50%; }
    #btnZap { background: #25D366; color: white; width: 100%; margin-top: 10px; }
  </style>
</head>
<body class="light">
  <audio id="beep" src="https://www.soundjay.com/button/button-16.wav" preload="auto"></audio>
  <audio id="vitoriaSom" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3" preload="auto"></audio>

  <main>
    <div class="topbar">
      <div class="row">
        <label for="difficulty">Dificuldade</label>
        <select id="difficulty">
          <option value="easy">F√°cil (1‚Äì50)</option>
          <option value="medium" selected>M√©dio (1‚Äì100)</option>
          <option value="hard">Dif√≠cil (1‚Äì200)</option>
        </select>
      </div>
      <button id="btnTheme">üåì Tema</button>
    </div>

    <h1>üéØ Chute Chute</h1>
    <p id="rangeInfo" class="muted"></p>

    <div class="card">
      <div id="gameArea" class="row">
        <input id="playerName" type="text" placeholder="Seu apelido" maxlength="15" />
        <input id="palpite" type="number" placeholder="Seu chute" />
        <button id="btnVerificar">CHUTAR</button>
      </div>

      <div id="againArea" class="hidden">
        <div id="msgVitoria" class="mensagem"></div>
        <button id="btnReiniciar" style="width: 100%;">Jogar Novamente</button>
        <button id="btnZap">üì± Compartilhar com amigos</button>
      </div>

      <div id="mensagem" class="mensagem"></div>

      <div class="ranking-section">
        <div class="status-online"><span class="dot"></span> RANKING GLOBAL AO VIVO</div>
        <table class="ranking-table">
          <thead>
            <tr><th>Pos.</th><th>Jogador</th><th>Chutes</th><th>N√≠vel</th></tr>
          </thead>
          <tbody id="rankingBody"></tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
    (function () {
      const API_URL = "/api/ranking";
      const DIFFICULTIES = { easy: 50, medium: 100, hard: 200 };
      let difficulty = 'medium', maxNumber = 100, numeroSecreto, tentativas = 0;

      const el = {
        diff: document.getElementById('difficulty'),
        palpite: document.getElementById('palpite'),
        msg: document.getElementById('mensagem'),
        ranking: document.getElementById('rankingBody'),
        btnVerificar: document.getElementById('btnVerificar'),
        btnAgain: document.getElementById('btnReiniciar'),
        name: document.getElementById('playerName'),
        areaGame: document.getElementById('gameArea'),
        areaAgain: document.getElementById('againArea'),
        range: document.getElementById('rangeInfo'),
        btnTheme: document.getElementById('btnTheme'),
        btnZap: document.getElementById('btnZap'),
        beep: document.getElementById('beep'),
        win: document.getElementById('vitoriaSom') // Refer√™ncia ao som de vit√≥ria
      };

      async function fetchGlobalRanking() {
        try {
          const res = await fetch(API_URL);
          const data = await res.json();
          renderTable(data);
        } catch (e) { el.ranking.innerHTML = '<tr><td colspan="4">Erro ao carregar ranking.</td></tr>'; }
      }

      async function saveRecord(nome, chutes, nivel) {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name: nome || 'An√¥nimo', tries: chutes, difficulty: nivel })
        });
        fetchGlobalRanking();
      }

      function renderTable(data) {
        el.ranking.innerHTML = data.map((r, i) => `<tr><td>${i+1}¬∫</td><td>${r.name}</td><td>${r.tries}</td><td>${r.difficulty}</td></tr>`).join('');
      }

      function startGame() {
        maxNumber = DIFFICULTIES[difficulty];
        numeroSecreto = Math.floor(Math.random() * maxNumber) + 1;
        tentativas = 0;
        el.msg.textContent = "";
        el.palpite.value = "";
        el.areaGame.classList.remove('hidden');
        el.areaAgain.classList.add('hidden');
        el.range.textContent = `Escolha um n√∫mero entre 1 e ${maxNumber}`;
        el.palpite.focus();
        fetchGlobalRanking();
      }

      el.palpite.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') el.btnVerificar.click();
      });

      el.btnVerificar.onclick = () => {
        el.beep.play(); 
        const p = parseInt(el.palpite.value);
        if (isNaN(p) || p < 1 || p > maxNumber) return;

        tentativas++;
        if (p === numeroSecreto) {
          el.win.play(); // Toca o som de vit√≥ria (Sininho)
          document.getElementById('msgVitoria').innerHTML = `üèÜ ACERTOU EM ${tentativas} CHUTES!`;
          el.areaGame.classList.add('hidden');
          el.areaAgain.classList.remove('hidden');
          saveRecord(el.name.value, tentativas, difficulty);
        } else {
          el.msg.textContent = p < numeroSecreto ? "üîº Mais alto!" : "üîΩ Mais baixo!";
          el.palpite.focus();
          el.palpite.select();
        }
      };

      el.btnZap.onclick = () => {
        const texto = encodeURIComponent(`üéØ Consegui acertar o n√∫mero secreto com ${tentativas} chutes no Chute Chute! Duvido voc√™ bater meu recorde: ${window.location.href}`);
        window.open(`https://wa.me/?text=${texto}`);
      };

      el.diff.onchange = () => { difficulty = el.diff.value; startGame(); };
      el.btnAgain.onclick = startGame;
      el.btnTheme.onclick = () => {
        const isDark = document.body.classList.toggle('dark');
        document.body.classList.toggle('light', !isDark);
      };

      startGame();
    })();
  </script>
</body>
</html>
